= Install the Trustee operator

In confidential computing environments, *attestation* is crucial in verifying the trustworthiness of the location where you plan to run your workload or where you plan to send confidential information. Before actually running the workload or transmitting the confidential information, you need to perform **attestation**.

The https://github.com/confidential-containers/trustee[Trustee project] (previously known as https://github.com/confidential-containers/kbs[CoCo KBS]) includes components deployed on a trusted side and used to verify whether the remote workload is running in a trusted execution environment (TEE). It also verifies that the remote environment uses the expected software and hardware versions.

For an **overview of attestation**, read our https://www.redhat.com/en/blog/learn-about-confidential-containers[Learn about Confidential Computing Attestation] blog series.

For details on **attestation flow in confidential containers**, read our https://www.redhat.com/en/blog/understanding-confidential-containers-attestation-flow[Understanding the Confidential Containers Attestation Flow] article.

There are two ways to install the Trustee operator:

* xref:01-install-trustee.adoc#webui[Install the operator using the web interface]
* xref:01-install-trustee.adoc#cmdline[Install the operator using the command line]

[#webui]
== Using the web interface

. In the Openshift Container Platform web console, navigate to **Operators > OperatorHub**.

. In the **Filter by keyword field**, type `trustee`.

. Click on the **confidential compute attestation** tile.
+
image::01-trustee-operatorhub-ui.png[link=self, window=blank]

. On the **Install Operator** page, select **stable** from the list of available **Update Channel** options.
+
image::02-install-ui.png[link=self, window=blank]

. Verify that **Operator recommended Namespace** is selected for **Installed Namespace**. This installs the Operator in the mandatory trustee-operator-system namespace. If this namespace does not yet exist, it is automatically created.

NOTE: Attempting to install the Trustee Operator in a namespace other than `trustee-operator-system` causes the installation to fail.

. Verify that **Automatic** is selected for **Update approval**. **Automatic** is the default value, and enables automatic updates to Trustee when a new z-stream release is available.

. Click **Install**.

The Trustee Operator is now installed on your cluster.

=== Verification

. Navigate to **Operators > Installed Operators**.

. Verify that the Trustee Operator is displayed.
+
image::03-trustee-install-ui.png[link=self, window=blank]

[#cmdline]
== Using the command line

TIP: If you don't want to copy-paste, there is a xref:01-install-osc.adoc#scripts[script] that performs all the steps above automatically.

. Create and apply a `Namespace.yaml` manifest file:
+
[source,sh,role=execute]
----
cat > Namespace.yaml <<EOF
apiVersion: v1
kind: Namespace
metadata:
  name: trustee-operator-system
EOF
----
+
[source,sh,role=execute]
----
oc apply -f Namespace.yaml
----

. Create and apply a `OperatorGroup.yaml` manifest file:
+
[source,sh,role=execute]
----
cat > OperatorGroup.yaml <<EOF
apiVersion: operators.coreos.com/v1
kind: OperatorGroup
metadata:
  name: trustee-operator-group
  namespace: trustee-operator-system
spec:
  targetNamespaces:
  - trustee-operator-system
EOF
----
+
[source,sh,role=execute]
----
oc apply -f OperatorGroup.yaml
----

. Create and apply a `Subscription.yaml` manifest file:
+
[source,sh,role=execute]
----
cat > Subscription.yaml <<EOF
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: trustee-operator
  namespace: trustee-operator-system
spec:
  channel: stable
  installPlanApproval: Automatic
  name: trustee-operator
  source: redhat-operators
  sourceNamespace: openshift-marketplace
  startingCSV: trustee-operator.v0.2.0
EOF
----
+
NOTE: You can change the operator version by changing the `startingCSV` field in the `Subscription.yaml` file.
+
[source,sh,role=execute]
----
oc apply -f Subscription.yaml
----

=== Verification
Ensure that the Operator is correctly installed by running the following command and checking that the `PHASE` is in `Succeeded` state:
[source,sh,role=execute]
----
oc get csv -n trustee-operator-system
----

**Example output**
[source,texinfo,subs="attributes"]
----
NAME                      DISPLAY                            VERSION   REPLACES   PHASE
trustee-operator.v0.2.0   confidential compute attestation   0.2.0                Succeeded
----

[#scripts]
=== Scripted way
Avoid copy-pasting all steps above and do it in one step:
NOTE: You can change the operator version by changing the `startingCSV` field under the `Subscription` resource type.
[source,sh,role=execute]
----
oc apply -f-<<EOF
---
apiVersion: v1
kind: Namespace
metadata:
  name: trustee-operator-system
---
apiVersion: operators.coreos.com/v1
kind: OperatorGroup
metadata:
  name: trustee-operator-group
  namespace: trustee-operator-system
spec:
  targetNamespaces:
  - trustee-operator-system
---
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: trustee-operator
  namespace: trustee-operator-system
spec:
  channel: stable
  installPlanApproval: Automatic
  name: trustee-operator
  source: redhat-operators
  sourceNamespace: openshift-marketplace
  startingCSV: trustee-operator.v0.2.0
EOF
----

=== Verification
Ensure that the Operator is correctly installed by running the following command and checking that the `PHASE` is in `Succeeded` state:
[source,sh,role=execute]
----
oc get csv -n trustee-operator-system
----
